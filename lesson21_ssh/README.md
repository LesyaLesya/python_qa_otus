# Работа с сетью 1

```
Добавить тесты, которые используют SSH клиент для реализации следующих сценариев: 
перезагрузка сервера opencart с последующей проверкой, что opencart доступен, 
рестарт основных сервисов для opencart с последующей проверкой, что сервис доступен.
```


1.В консоли перейти в директорию с файлом docker-compose.yml

2.Выполнить команду для запуска докер-образа opencart и вспомогательных сервисов:
```
docker-compose up -d
```
3.Посмотреть запущенные контейнеры: 
```
docker ps
```
4.Зайти в контейнер опенкарт под пользователем root командой:
```
docker exec -it -u 0 CONTAINER_ID /bin/bash
```
5.Выполнить команду для обновления локальных кэшей репозиториев:
```
apt-get update
```
6.Поставить openssh-server, vim (редактор), rsyslog (для теста рестарта сервиса):
```
apt-get install openssh-server vim rsyslog --no-install-recommends 
```
7.Сгенерировать SSH-ключ на локальном компьютере: 
(ключи и конфиги пользователя лежат в $HOME/.ssh ;
ключи и конфиги сервера лежат в /etc/ssh):
```
ssh-keygen
```
8.Скопировать публичный ключ с локального компьютера - id_rsa.pub

9.На сервере создать директорию и в ней создать файл authorized_keys и записать туда публичный ключ пользователя:
```
mkdir /root/.ssh
vim /root/.ssh/authorized_keys
```
10.Проверить запущенность ssh и запустить при необходимости:
```
service ssh status
service ssh start
```
11.Проверить запущенность rsyslog и запустить при необходимости:
```
service rsyslog status
service rsyslog start
```
12.Для подключения с локальной машины в контейнер:
```
ssh root@localhost -p 4422
```
13.Можно запускать тесты:

(ВАЖНО: если первым будет запущен тест на рестарт контейнера, то тест на рестарт 
сервиса завалится, так как сервис openssh-server не будет запущен после рестарта
контейнера (надо запускать будет вручную).
Поэтому в названиях тестов добавлены цифры - чтобы сначала проходил тест
рестарта сервиса, а затем тест на рестарт контейнера. 

Рестарт контейнера сделать изнутри
самого контейнера невозможно, поэтому выполняется не по ssh.

Чтобы повторно запустить тесты надо выполнить шаги 4 и 10 внутри контейнера)
```
pytest -v -s test_ssh.py 
``` 
